<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tetris.js</title>
    <style>
      :root {
        font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
        line-height: 1.5;
        font-weight: 400;

        color-scheme: dark light;
        color: rgba(255, 255, 255, 0.87);
        background-color: #242424;

        font-synthesis: none;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-text-size-adjust: 100%;
      }

      body {
        margin: 0;
        padding: 0;
        display: grid;
        place-content: center;
      }

      section {
        position: absolute;
        background: black;
        width: 100vw;
        height: 100hw;
        top: 0;
        inset: 0;
        display: grid;
        font-size: 48px;
        place-content: center;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <canvas></canvas>
    </div>

    <script>
      const EVENT_MOVEMENTS = {
        LEFT: "ArrowLeft",
        DOWN: "ArrowDown",
        RIGHT: "ArrowRight",
      };
      const PIECES = [
        [
          // la pieza amarilla
          [1, 1],
          [1, 1],
        ],
        [[1, 1, 1, 1]],
        [
          // es la pieza lila
          [0, 1, 0],
          [1, 1, 1],
        ],
        [
          // la pieza verde
          [1, 1, 0],
          [0, 1, 1],
        ],
        [
          [0, 1, 1],
          [1, 1, 0],
        ],
        [
          [1, 0],
          [1, 0],
          [1, 1],
        ],
        [
          [0, 1],
          [0, 1],
          [1, 1],
        ],
      ];

      const $canvas = document.querySelector("canvas");
      const $context = $canvas.getContext("2d");

      const BLOCK_SIZE = 20;
      const BOARD_WIDTH = 14;
      const BOARD_HEIGHT = 30;

      $canvas.width = BLOCK_SIZE * BOARD_WIDTH;
      $canvas.height = BLOCK_SIZE * BOARD_HEIGHT;

      $context.scale(BLOCK_SIZE, BLOCK_SIZE);

      const board = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
      ];

      const piece = {
        position: { x: 5, y: 5 },
        shape: [
          [1, 1],
          [1, 1],
        ],
      };
      //GAME LOOP
      function update() {
        draw();
        window.requestAnimationFrame(update);
      }

      function draw() {
        $context.fillStyle = "#000";
        $context.fillRect(0, 0, $canvas.width, $canvas.height);

        board.forEach((row, y) => {
          row.forEach((value, x) => {
            if (value === 1) {
              $context.fillStyle = "yellow";
              $context.fillRect(x, y, 1, 1);
            }
          });
        });

        piece.shape.forEach((row, y) => {
          row.forEach((value, x) => {
            if (value) {
              $context.fillStyle = "red";
              $context.fillRect(
                x + piece.position.x,
                y + piece.position.y,
                1,
                1
              );
            }
          });
        });
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === EVENT_MOVEMENTS.LEFT) {
          piece.position.x--;
          if (checkCollision()) {
            piece.position.x++;
          }
        }
        if (e.key === EVENT_MOVEMENTS.RIGHT) {
          piece.position.x++;
          if (checkCollision()) {
            piece.position.x--;
          }
        }
        if (e.key === EVENT_MOVEMENTS.DOWN) {
          piece.position.y++;
          if (checkCollision()) {
            piece.position.y--;
          }
        }
      });

      function checkCollision() {
        return piece.shape.find((row, y) => {
          return row.find((value, x) => {
            return (
              value === 1 &&
              board[y + piece.position.y]?.[x + piece.position.x] !== 0
            );
          });
        });
      }

      update();
    </script>
  </body>
</html>
